---
layout: post
title: "MySQL 索引、并发、事务详解"
date: 2019-05-28 15:14:20 +0800
comments: true
categories: mysql
---

### MySQL 索引、并发、事务详解


#### Mysql索引

- MySQL索引可以有 `哈希索引` 、 `B+索引`、当只有查询某一条唯一记录是哈希索引是比较快的。 O（1）时间常量获取。 当获取排序、范围、分组数据是。 哈希索引就没法高效使用，退回O（n)去检索。而树形结构本身具有有序性、时间复杂度还是可以O（logN)。绝大部分数据库场景还都是范围、排序去检索数据。因此数据库采用树形结构设计索引。

- MySQL 使用 `B+树` 结构、每一个非子叶点上存储的是PK值、叶子节点存储的是PK值和对应的记录。同时每个叶子节点之间采用链表连接， 当范围查询是，就可以在连续范围内查询到数据、而不是回溯遍历数的其他节点。（InnoDB引擎叶子结点存储着PK和记录、而Myisam引擎索引记录和数据是分开的，存储的指向数据的指针）。

- 聚集索引 vs 非聚集索引

    1. 索引和数据行存储在一起的 ` 聚集索引`
    2. 索引和数据行分开存储的 ` 非聚集索引`
    3. Myisam 引擎的主键索引和普通索引本质上没有区别（主键列、索引列）。叶子节点都是存储的索引和执行数据的指针。
    4. InnoDB 引擎 是聚集索引。索引和记录是在一起的。普通索引存储的数据、是主键值。因此普通的索引是需要二次扫描索引才能找到数据的。


#### MySQL 锁的种类

- 共享锁/排他锁 (Share/Exlusive Locks)
- 意向锁 (Intention Lock)
- 插入意向锁 (Insert Intention Lock)
- 记录锁 (Record Lock)
- 间隙锁 (GAP Lock)
- 临键锁 (Next-key Lock)
- 自增锁 (Inc Lock）


#### 提供数据库的并发的思路

- 普通锁机制，本质上是串行化执行。
- 读写锁、可以先实现读读并发。
    - `共享锁` （Share Locks) S 锁 。读取数据加 S 锁。
    - `排它锁`  (Exclusive Locks) X 锁。 修改数据加 X锁。
- 数据多版本、可以实现读写并行。

- 共享锁 获取到共享锁后， 其他事务还是可以获取到共享锁。共享锁与共享锁不互斥。
- 排它锁不与任何锁共享。 排它锁与其他任何锁互斥。

